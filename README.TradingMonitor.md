# SL Trading äº¤æ˜“äº‹ä»¶ç›‘æ§å™¨

## ğŸ“‹ åŠŸèƒ½æè¿°

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨è¿è¡Œçš„ç›‘æ§ç¨‹åºï¼Œç”¨äºï¼š
- æ¯åˆ†é’Ÿè‡ªåŠ¨è¯»å– SL Trading ç¨‹åºçš„äº¤æ˜“äº‹ä»¶
- è§£æ Anchor äº‹ä»¶æ•°æ®ï¼ˆTradeEventï¼‰
- å°†æ•°æ®ç¼“å­˜åˆ°æœ¬åœ° JSON æ–‡ä»¶
- æä¾›è¯¦ç»†çš„è¿è¡Œæ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
npm install
```

### 2. å¯åŠ¨ç›‘æ§å™¨
```bash
# å¯åŠ¨ç›‘æ§å™¨
npm run monitor

# å¼€å‘æ¨¡å¼ï¼ˆæ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡å¯ï¼‰
npm run monitor:dev
```

### 3. æŸ¥çœ‹ç›‘æ§çŠ¶æ€
```bash
# æŸ¥çœ‹å½“å‰çŠ¶æ€
npm run monitor:status

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
npm run monitor:help
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
scripts/
â”œâ”€â”€ trading-monitor.ts     # ä¸»ç›‘æ§è„šæœ¬
â”œâ”€â”€ monitor-status.ts      # çŠ¶æ€æŸ¥çœ‹è„šæœ¬
â””â”€â”€ README.md             # è¯´æ˜æ–‡æ¡£

cache/                     # è‡ªåŠ¨åˆ›å»ºçš„ç¼“å­˜ç›®å½•
â”œâ”€â”€ trading-events.json    # äº¤æ˜“äº‹ä»¶ç¼“å­˜
â””â”€â”€ monitor.log           # è¿è¡Œæ—¥å¿—
```

## âš™ï¸ é…ç½®è¯´æ˜

ç›‘æ§å™¨é…ç½®åœ¨ `scripts/trading-monitor.ts` ä¸­ï¼š

```typescript
const CONFIG = {
  // SL Trading ç¨‹åºåœ°å€
  PROGRAM_ADDRESS: 'EAJ7QiDXgXH31m57RhDFMHTkBrDzxrFpcN8xUkPUqHLi',
  
  // Solana RPC èŠ‚ç‚¹
  RPC_URL: 'https://api.devnet.solana.com',
  
  // ç›‘æ§é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  MONITOR_INTERVAL: 60 * 1000,  // 1åˆ†é’Ÿ
  
  // æ¯æ¬¡è·å–çš„äº¤æ˜“æ•°é‡
  BATCH_SIZE: 50,
  
  // å¹¶å‘è¯·æ±‚é™åˆ¶
  CONCURRENCY_LIMIT: 5,
}
```

## ğŸ“Š æ•°æ®æ ¼å¼

### ç¼“å­˜çš„äº¤æ˜“äº‹ä»¶æ•°æ®æ ¼å¼ï¼š
```json
{
  "lastUpdate": 1640995200000,
  "lastSignature": "5KJp...",
  "totalEvents": 42,
  "monitorStartTime": 1640995000000,
  "events": [
    {
      "signature": "5KJp...",
      "blockTime": 1640995200,
      "slot": 123456789,
      "id": "trade-001",
      "userId": "user-abc", 
      "fundId": "fund-xyz",
      "tradeType": 0,        // 0=BUY, 1=SELL
      "amount": "1000000n",  // BigInt æ ¼å¼
      "price": "50000000n",
      "timestamp": "1640995200n",
      "parsedAt": 1640995200123
    }
  ]
}
```

## ğŸ” ç›‘æ§å™¨åŠŸèƒ½

### è‡ªåŠ¨æ•°æ®é‡‡é›†
- **å¢é‡æ›´æ–°**ï¼šåªè·å–ä¸Šæ¬¡æ£€æŸ¥åçš„æ–°äº¤æ˜“
- **æ–­ç‚¹ç»­ä¼ **ï¼šé‡å¯åä»æœ€åä¸€ä¸ªç­¾åç»§ç»­
- **æ™ºèƒ½è§£æ**ï¼šè‡ªåŠ¨è¯†åˆ« TradeEvent äº‹ä»¶
- **é”™è¯¯æ¢å¤**ï¼šç½‘ç»œé”™è¯¯æ—¶è‡ªåŠ¨é‡è¯•

### æ€§èƒ½ä¼˜åŒ–
- **æ‰¹é‡å¤„ç†**ï¼šåˆ†æ‰¹è·å–äº¤æ˜“ä»¥é¿å… RPC é™åˆ¶
- **å¹¶å‘æ§åˆ¶**ï¼šé™åˆ¶åŒæ—¶è¯·æ±‚æ•°é‡
- **ç¼“å­˜ç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®ï¼ˆä¿ç•™æœ€è¿‘1000æ¡ï¼‰
- **é¢‘ç‡æ§åˆ¶**ï¼šè¯·æ±‚é—´æ·»åŠ å»¶è¿Ÿé¿å…é™æµ

### æ•°æ®å®Œæ•´æ€§
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- **æ•°æ®éªŒè¯**ï¼šäº‹ä»¶æ ¼å¼æ ¡éªŒ
- **æ—¶é—´æˆ³ä¿®æ­£**ï¼šå¤„ç†å†å²æ•°æ®æ—¶é—´å¼‚å¸¸
- **ç­¾åè·Ÿè¸ª**ï¼šåŸºäºäº¤æ˜“ç­¾åçš„å¢é‡åŒæ­¥

## ğŸ“ˆ ç›‘æ§ç»Ÿè®¡

è¿è¡Œ `npm run monitor:status` å¯ä»¥æŸ¥çœ‹ï¼š

- **åŸºç¡€ä¿¡æ¯**ï¼šè¿è¡Œæ—¶é—´ã€æ€»äº‹ä»¶æ•°ã€ç¼“å­˜çŠ¶æ€
- **äº‹ä»¶ç»Ÿè®¡**ï¼šä¹°å…¥/å–å‡ºäº‹ä»¶æ•°é‡
- **æœ€è¿‘æ´»åŠ¨**ï¼šæœ€æ–°5ä¸ªäº¤æ˜“äº‹ä»¶
- **ç”¨æˆ·ç»Ÿè®¡**ï¼šå”¯ä¸€ç”¨æˆ·å’ŒåŸºé‡‘æ•°é‡
- **ç³»ç»Ÿæ—¥å¿—**ï¼šæœ€è¿‘çš„è¿è¡Œæ—¥å¿—

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨ç›‘æ§å™¨
npm run monitor

# åå°è¿è¡Œï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
nohup npm run monitor > monitor.log 2>&1 &

# æŸ¥çœ‹çŠ¶æ€
npm run monitor:status

# æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶
cat cache/trading-events.json | jq .

# æŸ¥çœ‹è¿è¡Œæ—¥å¿—
tail -f cache/monitor.log

# åœæ­¢ç›‘æ§å™¨
# ä½¿ç”¨ Ctrl+C æˆ–å‘é€ SIGINT ä¿¡å·
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼“å­˜æ–‡ä»¶æŸå**
   ```bash
   rm cache/trading-events.json
   npm run monitor
   ```

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   - æ£€æŸ¥ RPC èŠ‚ç‚¹çŠ¶æ€
   - å°è¯•æ›´æ¢ RPC_URL

3. **æƒé™é—®é¢˜**
   ```bash
   chmod +x scripts/trading-monitor.ts
   ```

4. **ä¾èµ–é—®é¢˜**
   ```bash
   npm install
   npm run monitor
   ```

### è°ƒè¯•æ¨¡å¼

åœ¨ç›‘æ§è„šæœ¬ä¸­å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```typescript
// åœ¨ CONFIG ä¸­æ·»åŠ 
DEBUG: true
```

## ğŸ“ å¼€å‘è¯´æ˜

### æ‰©å±•ç›‘æ§å™¨

è¦æ·»åŠ æ–°åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹ `TradingMonitor` ç±»ï¼š

```typescript
class TradingMonitor {
  // æ·»åŠ æ–°çš„é…ç½®
  private customConfig = { ... }
  
  // æ·»åŠ æ–°çš„å¤„ç†æ–¹æ³•
  private async processCustomEvent(event: TradeEventData) {
    // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
  }
}
```

### è‡ªå®šä¹‰è§£æå™¨

è¦æ”¯æŒå…¶ä»–ç±»å‹çš„äº‹ä»¶ï¼š

```typescript
private async parseCustomEvents(transaction: any): Promise<CustomEventData[]> {
  // è‡ªå®šä¹‰è§£æé€»è¾‘
}
```

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

- **åªè¯»è®¿é—®**ï¼šç›‘æ§å™¨åªè¯»å–é“¾ä¸Šæ•°æ®ï¼Œä¸æ‰§è¡Œä»»ä½•å†™æ“ä½œ
- **API å¯†é’¥**ï¼šå¦‚ä½¿ç”¨ä»˜è´¹ RPCï¼Œè¯·å¦¥å–„ä¿ç®¡ API å¯†é’¥
- **ç¼“å­˜æ¸…ç†**ï¼šå®šæœŸæ¸…ç†ç¼“å­˜æ–‡ä»¶é¿å…ç£ç›˜å ç”¨è¿‡å¤§
- **ç½‘ç»œå®‰å…¨**ï¼šç¡®ä¿ RPC è¿æ¥ä½¿ç”¨ HTTPS

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç›‘æ§å™¨æ—¥å¿—ï¼š`cache/monitor.log`
2. ç¼“å­˜çŠ¶æ€ï¼š`npm run monitor:status`
3. ç½‘ç»œè¿æ¥ï¼šæµ‹è¯• RPC èŠ‚ç‚¹å¯ç”¨æ€§
4. ç¨‹åºçŠ¶æ€ï¼šç¡®è®¤ SL Trading ç¨‹åºæ­£å¸¸è¿è¡Œ

---

âœ¨ **Happy Monitoring!** ç›‘æ§å™¨å°†ä¸ºæ‚¨æä¾› SL Trading ç¨‹åºçš„å®æ—¶äº¤æ˜“æ•°æ®ï¼ 